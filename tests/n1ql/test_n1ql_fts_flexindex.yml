---
-
  include: tests/templates/rebalance.yml, tests/templates/n1ql.yml, tests/templates/kv.yml, tests/templates/fts.yml

############### data loading ################
- image: sequoiatools/gideon
  command: "kv --ops {{.Scale 1000}} --create 60 --get 40 --delete 10  --expire 100 --ttl 600   --hosts {{.Orchestrator}} --bucket {{.Bucket}}"
- command: "kv --ops {{.Scale 500}} --create 60 --get 40 --sizes 64 96 --expire 100 --ttl 600  --hosts {{.Orchestrator}} --bucket {{.NthBucket 1}}"
- command: "kv --ops {{.Scale 500}} --create 60 --get 40 --sizes 64 96 --delete 20 --expire 100 --ttl 600  --hosts {{.Orchestrator}} --bucket {{.NthBucket 2}}"

# Create index default mapping index on bucket1
-
  template: create_index_with_default_mapping_with_specific_analyzer
  args: "{{.FTSNodePort}}, default_idx1, {{.Bucket}}, scorch, keyword"
  wait: true

# Create index - custom mapping index on bucket2 on fields - rating result sizes
-
  template: create_index_with_3_child_fields
  args: "{{.FTSNodePort}}, bucket1_idx1, {{.NthBucket 1}}, gideon, rating, number, result, text, sizes, text"
  wait: true

# Create index - custom mapping index on bucket2 on fields - result sizes activity
-
  template: create_index_with_3_child_fields
  args: "{{.FTSNodePort}}, bucket1_idx2, {{.NthBucket 1}}, gideon, result, text, sizes, text, activity, number"
  wait: true

# Create index - custom mapping index on bucket2 on fields - result sizes activity
-
  template: create_index_with_3_child_fields
  args: "{{.FTSNodePort}}, bucket2_idx1, {{.NthBucket 2}}, gideon, rating, number, result, text, build_id, number"
  wait: true


# ###############  run queries ################
- section_start: query_replica_indexes
- image: sequoiatools/queryapp
  command: "-J-cp /AnalyticsQueryApp/Couchbase-Java-Client-2.5.6/* /AnalyticsQueryApp/Query/load_queries.py --server_ip {{.Nodes | .Service `n1ql` | net 0}} --port {{.QueryPort}} --duration 0 --print_duration=3600 --bucket {{.Bucket}} --querycount 5 --threads 5 --n1ql True --query_file flex_index_queries.txt --query_timeout=600 --bucket_names [{{.Bucket}},{{.NthBucket 1}},{{.NthBucket 2}}]"
  wait: true


